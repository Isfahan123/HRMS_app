{% extends "base.html" %}

{% block title %}HRMS Dashboard{% endblock %}

{% block content %}
<div class="dashboard-container">
    <header class="dashboard-header">
        <h1>Welcome, {{ full_name or user_email }}</h1>
        <a href="/logout" class="logout-button">ğŸ”’ Logout</a>
    </header>
    
    <div class="tabs">
        <button class="tab-button active" data-tab="home">ğŸ  Home</button>
        <button class="tab-button" data-tab="profile">ğŸ‘¤ Profile</button>
        <button class="tab-button" data-tab="attendance">ğŸ“… Attendance</button>
        <button class="tab-button" data-tab="leave">ğŸ“¬ Leave Request</button>
        <button class="tab-button" data-tab="payroll">ğŸ’¸ Payroll</button>
        <button class="tab-button" data-tab="engagements">ğŸ—‚ Engagements</button>
    </div>
    
    <div class="tab-content">
        <div id="home-tab" class="tab-pane active">
            <div class="summary-section">
                <h2>Your Summary</h2>
                <div class="summary-grid">
                    <div class="summary-item">
                        <strong>ğŸ“… Attendance:</strong>
                        <span id="attendance-summary">Loading...</span>
                    </div>
                    <div class="summary-item">
                        <strong>ğŸ“¬ Leave Requests:</strong>
                        <span id="leave-summary">Loading...</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="profile-tab" class="tab-pane">
            <h2>Profile</h2>
            <div id="profile-content">
                <p>Loading profile information...</p>
            </div>
        </div>
        
        <div id="attendance-tab" class="tab-pane">
            <h2>Attendance</h2>
            <div id="attendance-content">
                <p>Loading attendance records...</p>
            </div>
        </div>
        
        <div id="leave-tab" class="tab-pane">
            <h2>Leave Requests</h2>
            <div id="leave-content">
                <p>Loading leave requests...</p>
            </div>
        </div>
        
        <div id="payroll-tab" class="tab-pane">
            <h2>Payroll</h2>
            <div id="payroll-content">
                <p>Loading payroll information...</p>
            </div>
        </div>
        
        <div id="engagements-tab" class="tab-pane">
            <h2>Engagements (Training & Trips)</h2>
            <div id="engagements-content">
                <p>Loading engagements...</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Tab switching functionality
document.querySelectorAll('.tab-button').forEach(button => {
    button.addEventListener('click', () => {
        const tabName = button.getAttribute('data-tab');
        
        // Remove active class from all tabs and buttons
        document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
        
        // Add active class to clicked button and corresponding tab
        button.classList.add('active');
        document.getElementById(tabName + '-tab').classList.add('active');
        
        // Load data for the tab if needed
        loadTabData(tabName);
    });
});

// Load summary data on page load
async function loadSummaryData() {
    try {
        // Load attendance summary
        const attendanceResponse = await fetch('/api/attendance');
        const attendanceData = await attendanceResponse.json();
        if (attendanceData.success && attendanceData.data && attendanceData.data.length > 0) {
            document.getElementById('attendance-summary').textContent = 
                `Recent check-in: ${attendanceData.data[0].date || 'N/A'}`;
        } else {
            document.getElementById('attendance-summary').textContent = 'No recent records';
        }
        
        // Load leave summary
        const leaveResponse = await fetch('/api/leave-requests');
        const leaveData = await leaveResponse.json();
        if (leaveData.success && leaveData.data) {
            const pendingCount = leaveData.data.filter(req => req.status === 'pending').length;
            document.getElementById('leave-summary').textContent = 
                pendingCount > 0 ? `${pendingCount} pending request(s)` : 'No pending requests';
        } else {
            document.getElementById('leave-summary').textContent = 'No pending requests';
        }
    } catch (error) {
        console.error('Error loading summary:', error);
    }
}

function loadTabData(tabName) {
    // Implement lazy loading of tab data as needed
    console.log('Loading data for tab:', tabName);
}

// Load initial data
loadSummaryData();
</script>
{% endblock %}
